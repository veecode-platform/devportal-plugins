app:
  title: Scaffolded Backstage App
  baseUrl: http://localhost:3000
  
organization:
  name: My Kubernetes

catalog:
  locations:
    # Local example data, file locations are relative to the backend process, typically `packages/backend`
    - type: file
      target: /app/examples/entities.yaml
    # Local example template
    - type: file
      target: /app/examples/template/template.yaml
      rules:
        - allow: [Template]
    # Local example organizational data
    - type: file
      target: /app/examples/org.yaml
      rules:
        - allow: [User, Group]
    # Local example cluster data
    - type: file
      target: /app/examples/clusters.yaml
      rules:
        - allow: [Resource]

kubernetes:
  # see https://backstage.io/docs/features/kubernetes/configuration for kubernetes configuration options
  serviceLocatorMethod:
    type: 'singleTenant'
  clusterLocatorMethods:
    # Catalog-based discovery - enables per-entity cluster filtering via backstage.io/kubernetes-id
    #- type: 'catalog'
    
    # Config-based clusters - provides credentials for serviceAccount auth provider
    # These must match the cluster names in the catalog entities
    - type: 'config'
      clusters:
        - name: vkdr-config-cluster
          url: ${TUNNEL_URL} 
          authProvider: 'serviceAccount'
          skipTLSVerify: false
          caData: ${K8S_CA_DATA}
          serviceAccountToken: ${K8S_SA_TOKEN}
        - name: vkdr-catalog-cluster
          url: ${TUNNEL_URL} 
          authProvider: 'serviceAccount'
          skipTLSVerify: false
          caData: ${K8S_CA_DATA}
          authMetadata:
            secretName: "mysecret"
            # source: secret (k8s secret), env (env var), file (file)
            source: secret
            namespace: default
        - name: vkdr-yet-another-cluster
          url: ${TUNNEL_URL} 
          caData: ${K8S_CA_DATA}
          authProvider: 'serviceAccount'

veecode:
  kubernetes:
    # when adding our custom auth strategy, set this to true IF you want to keep the 
    # default auth strategies, or they will be removed
    # NOTE: our custom auth strategy will override the default serviceAccount auth strategy
    # but will invoke normally it if the cluster does not have a secretName in the authMetadata
    addDefaultKubernetesAuthStrategies: false
    # avoid using @kubernetes/client-node to fetch secrets
    fetchSecretWithRawHttps: false
